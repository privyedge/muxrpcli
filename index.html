<html>
    <head>
    <title>muxrpcli - Documentation - SSBC</title>
    <link rel="stylesheet" href="/normalize.css">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/atelier-forest-light.css">
    <script src="/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
    <body>
      <div id="topnav">
    <div id="topnav-inner">
      <a class="topnav-item " href="/" title="Home">
      Home<br><small>SSBC</small>
    </a>
      <a class="topnav-item " href="/patchwork" title="Patchwork">
      Patchwork<br><small>Social Messaging App</small>
    </a>
      <a class="topnav-item " href="/scuttlebot" title="Scuttlebot">
      Scuttlebot<br><small>P2P Log Store</small>
    </a>
      <a class="topnav-item selected" href="/docs" title="Documentation">
      Documentation<br><small>APIs, Articles</small>
    </a>
    </div>
  </div>
      <div id="layout">
        <div id="leftnav">
      <div class="leftnav-item">Key Concepts</div>
      <div class="leftnav-subitems">
        <div class="leftnav-item ">
      <a href="/secure-scuttlebutt" title="Secure Scuttlebutt: a global database protocol">Secure Scuttlebutt: a global database protocol</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/ssb/linking.html" title="Content-Hash Linking">Content-Hash Linking</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/ssb/secret-handshake.html" title="Secret Handshake: a secure channel protocol">Secret Handshake: a secure channel protocol</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/ssb/end-to-end-encryption.html" title="Private Box: metadata-free encryption">Private Box: metadata-free encryption</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/ssb/faq.html" title="Frequently Asked Questions">Frequently Asked Questions</a>
    </div>
      </div>
      <div class="leftnav-item">API Documentation</div>
      <div class="leftnav-subitems">
        <div class="leftnav-item ">
      <a href="/scuttlebot/api.html" title="scuttlebot">scuttlebot</a>
    </div>
        <div class="leftnav-indent">
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/blobs.html" title="blobs">blobs</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/block.html" title="block">block</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/friends.html" title="friends">friends</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/gossip.html" title="gossip">gossip</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/invite.html" title="invite">invite</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/private.html" title="private">private</a>
    </div>
          <div class="leftnav-item ">
      <a href="/scuttlebot/plugins/replicate.html" title="replicate">replicate</a>
    </div>
        </div>
        <div class="leftnav-item ">
      <a href="/ssb-client" title="ssb-client">ssb-client</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-feed" title="ssb-feed">ssb-feed</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-keys" title="ssb-keys">ssb-keys</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-msgs" title="ssb-msgs">ssb-msgs</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-msg-schemas" title="ssb-msg-schemas">ssb-msg-schemas</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-ref" title="ssb-ref">ssb-ref</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-markdown" title="ssb-markdown">ssb-markdown</a>
    </div>
        <div class="leftnav-item ">
      <a href="/patchwork-threads" title="patchwork-threads">patchwork-threads</a>
    </div>
        <div class="leftnav-item ">
      <a href="/ssb-config" title="ssb-config">ssb-config</a>
    </div>
        <div class="leftnav-item ">
      <a href="/secret-stack" title="secret-stack">secret-stack</a>
    </div>
        <div class="leftnav-item ">
      <a href="/muxrpc" title="muxrpc">muxrpc</a>
    </div>
        <div class="leftnav-item selected">
      <a href="/muxrpcli" title="muxrpcli">muxrpcli</a>
    </div>
        <div class="leftnav-item ">
      <a href="/mdmanifest" title="mdmanifest">mdmanifest</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/api/pull-stream.html" title="pull-stream">pull-stream</a>
    </div>
      </div>
      <div class="leftnav-item">Articles</div>
      <div class="leftnav-subitems">
        <div class="leftnav-item ">
      <a href="/docs/articles/design-challenge-avoid-centralization-and-singletons.html" title="Design Challenge: Avoiding Centralization and Singletons">Design Challenge: Avoiding Centralization and Singletons</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/articles/design-challenge-sybil-attack.html" title="Design Challenge: Sybil Attacks">Design Challenge: Sybil Attacks</a>
    </div>
        <div class="leftnav-item ">
      <a href="/docs/articles/using-trust-in-open-networks.html" title="Using Trust in Open Networks">Using Trust in Open Networks</a>
    </div>
      </div>
    </div>
        <div id="content">
          <h1 id="muxrpcli">muxrpcli</h1>
<p>Command-line interface to <a href="https://github.com/ssbc/muxrpc">muxrpc</a> servers.
Works by converting the command-line parameters into args for the RPC calls.
Also adds some standard behaviors for usage calls.</p>
<h2 id="cli-parameters">CLI Parameters</h2>
<p>Parameters are parsed with <a href="https://www.npmjs.com/package/minimist">minimist</a>.
The first positional param is mapped to the rpc command.
Any subsequent positional params are passed as arguments.
Then, the object constructed by the named parameters (if there are any) is passed as the last argument.</p>
<p>Examples:</p>
<pre><code>$ program command arg1 arg2
invokes `server.command(&quot;arg1&quot;, &quot;arg2&quot;)`

$ program command -a beep -b boop
invokes `server.command({ a: &quot;beep&quot;, b: &quot;boob&quot; })&#39;

$ program command arg1 arg2 -a beep -b boop
invokes `server.command(&quot;arg1&quot;, &quot;arg2&quot;, { a: &quot;beep&quot;, b: &quot;boob&quot; })&#39;

$ program command -a beep -b boop arg1 arg2 
invokes `server.command(&quot;arg1&quot;, &quot;arg2&quot;, { a: &quot;beep&quot;, b: &quot;boob&quot; })&#39;
</code></pre><p>If a stream is supplied to stdin, it will be parsed as JSON and used instead of the CLI parameters.</p>
<pre><code>$ echo &#39;{&quot;a&quot;:&quot;beep&quot;,&quot;b&quot;:&quot;boop&quot;}&#39; | program command
invokes `server.command({ a: &quot;beep&quot;, b: &quot;boob&quot; })&#39;
</code></pre><h2 id="usage-calls">Usage calls</h2>
<p>Usage-calls are the help which is output when a command fails, or when help is requested.
They are used in the following situations:</p>
<ul>
<li>If the command does not exist in the RPC server&#39;s manifest, does a top-level usage call.</li>
<li>If the command responses with a <code>TypeError</code>, <code>UsageError</code>, <code>BadParamError</code>, or <code>BadArgError</code>, does a usage call for that command.</li>
<li>If the <code>-h</code> or <code>--help</code> switches are given, does a toplevel or command usage call.</li>
</ul>
<p>A usage-call is a call to the <code>usage(cmd)</code> function on the RPC server.
A &#39;top-level&#39; usage call will leave <code>cmd</code> falsey.
The <code>usage</code> method should return a string to display.</p>
<h2 id="example-rpc-server">Example rpc server</h2>
<pre><code class="lang-js">var zerr = require(&#39;zerr&#39;)
var MissingArgError = zerr(&#39;BadArg&#39;, &#39;&quot;%&quot; is required&#39;)
var BadTypeError = zerr(&#39;BadArg&#39;, &#39;&quot;%&quot; must be a valid %&#39;)

var manifest = {
  usage: &#39;sync&#39;,
  whoami: &#39;sync&#39;,
  ping: &#39;async&#39;
}
var api = {}
// muxrpc(null, manifest)(api) is called

api.usage = function (cmd) {
  switch (cmd) {
    case &#39;whoami&#39;:
      return &#39;whoami. get your profile info.&#39;
    case &#39;ping&#39;:
      return &#39;ping {target} [-n times]. send `n` pings to `target`, defaults to 1&#39;
  }
  return [
    &#39;myexample usage:&#39;
    &#39; - &#39; + api.usage(&#39;whoami&#39;),
    &#39; - &#39; + api.usage(&#39;ping&#39;)
  ].join(&#39;\n&#39;)
}

api.whoami = function() { return &#39;bob, obviously&#39; }

api.ping = function(target, opts, cb) {
  if (!target) return cb(MissingArgError(&#39;target&#39;))
  if (!isAddress(target)) return cb(BadTypeError(&#39;target&#39;, &#39;address&#39;))

  var n = 1
  if (opts &amp;&amp; opts.n) {
    n = +opts.n
    if (isNaN(n)) return cb(BadTypeError(&#39;n&#39;, &#39;number&#39;))
  }

  // ...
}
</code></pre>
<p>Here&#39;s how a session would behave with this server:</p>
<pre><code>$ myexample
myexample usage:
 - whoami. get your profile info.
 - ping {target} [-n times]. send `n` pings to `target. defaults to 1

$ myexample whoami -h
whoami. get your profile info.

$ myexample ping -h
ping {target} [-n times]. send `n` pings to `target. defaults to 1

$ myexample whoami
bob, obviously

$ myexample ping 127.0.0.1
...

$ myexample ping 1123123123
[BadArgError: &quot;target&quot; must be a valid address]
ping {target} [-n times]. send `n` pings to `target. defaults to 1


$ myexample ping 127.0.0.1 -n foobar
[BadArgError: &quot;n&quot; must be a valid number]
ping {target} [-n times]. send `n` pings to `target. defaults to 1
</code></pre>
        </div>
      </div>
    </body>
  </html>